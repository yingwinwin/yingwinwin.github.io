(window.webpackJsonp=window.webpackJsonp||[]).push([[61],{129:function(e,n,t){"use strict";t.r(n),t.d(n,"frontMatter",(function(){return a})),t.d(n,"metadata",(function(){return u})),t.d(n,"toc",(function(){return l})),t.d(n,"default",(function(){return c}));var o=t(3),s=t(7),r=(t(0),t(134)),a={id:"reactHook",title:"Hook\u57fa\u672c\u4f7f\u7528"},u={unversionedId:"reactHook",id:"reactHook",isDocsHomePage:!1,title:"Hook\u57fa\u672c\u4f7f\u7528",description:"hook\u539f\u7406\u6d45\u6790",source:"@site/docs/reactHook.md",slug:"/reactHook",permalink:"/docs/reactHook",editUrl:"https://github.com/yingwinwin/yingwinwin.github.io/tree/master/docs/reactHook.md",version:"current",sidebar:"someError",previous:{title:"Rem\u5e03\u5c40\u81ea\u9002\u5e94",permalink:"/docs/remFit"},next:{title:"react\u4e2d\u4f7f\u7528ts",permalink:"/docs/reactUseTs"}},l=[{value:"1. \u4ecb\u7ecd",id:"1-\u4ecb\u7ecd",children:[]},{value:"2. hook\u539f\u7406",id:"2-hook\u539f\u7406",children:[{value:"2.1 useState",id:"21-usestate",children:[]},{value:"2.2 useEffect",id:"22-useeffect",children:[]},{value:"2.3 useLayoutEffect",id:"23-uselayouteffect",children:[]},{value:"2.4 useMemo \u548c useCallback",id:"24-usememo-\u548c-usecallback",children:[]},{value:"2.5 useContext",id:"25-usecontext",children:[]},{value:"2.6 useReducer",id:"26-usereducer",children:[]}]}],d={toc:l};function c(e){var n=e.components,t=Object(s.a)(e,["components"]);return Object(r.b)("wrapper",Object(o.a)({},d,t,{components:n,mdxType:"MDXLayout"}),Object(r.b)("h1",{id:"hook\u539f\u7406\u6d45\u6790"},"hook\u539f\u7406\u6d45\u6790"),Object(r.b)("h2",{id:"1-\u4ecb\u7ecd"},"1. \u4ecb\u7ecd"),Object(r.b)("blockquote",null,Object(r.b)("p",{parentName:"blockquote"},"react-hooks\n\u7b2c\u4e00\uff1a\u89e3\u51b3\u51fd\u6570\u7ec4\u4ef6\u72b6\u6001\u4e0d\u80fd\u4fdd\u5b58\u7684\u95ee\u9898\u3002\n\u7b2c\u4e8c\uff1a\u89e3\u51b3\u7c7b\u7ec4\u4ef6\u903b\u8f91\u590d\u7528\u96be\u7684\u95ee\u9898\u3002")),Object(r.b)("ul",null,Object(r.b)("li",{parentName:"ul"},"\u5e26\u7740\u95ee\u9898\u53bb\u8fdb\u884c\u5b66\u4e60\u3002")),Object(r.b)("ol",null,Object(r.b)("li",{parentName:"ol"},"\u51fd\u6570\u7ec4\u4ef6\u4e0d\u50cf",Object(r.b)("inlineCode",{parentName:"li"},"class"),"\u7ec4\u4ef6\u4e2d\u6709\u5b9e\u4f8b\u6302\u8f7d\u5c5e\u6027\uff0c\u90a3\u4e48",Object(r.b)("inlineCode",{parentName:"li"},"hook"),"\u4e2d\u7684\u72b6\u6001\u662f\u600e\u4e48\u50a8\u5b58\u7684\uff1f"),Object(r.b)("li",{parentName:"ol"},Object(r.b)("inlineCode",{parentName:"li"},"react"),"\u5b98\u7f51\u4e2d\u8bf4\uff0c\u4e0d\u80fd\u5728",Object(r.b)("inlineCode",{parentName:"li"},"if"),"\u8bed\u53e5\u4e2d\u58f0\u660e",Object(r.b)("inlineCode",{parentName:"li"},"hook"),"\u7684\u539f\u56e0\u662f\u4ec0\u4e48\uff1f"),Object(r.b)("li",{parentName:"ol"},Object(r.b)("inlineCode",{parentName:"li"},"useEffect")," \u548c ",Object(r.b)("inlineCode",{parentName:"li"},"useLayoutEffect")," \u7684\u533a\u522b\u662f\u4ec0\u4e48\uff1f"),Object(r.b)("li",{parentName:"ol"},Object(r.b)("inlineCode",{parentName:"li"},"useCallback")," \u548c ",Object(r.b)("inlineCode",{parentName:"li"},"useMemo")," \u7684\u533a\u522b\u662f\u4ec0\u4e48\uff1f")),Object(r.b)("ul",null,Object(r.b)("li",{parentName:"ul"},"\u9884\u5907\u77e5\u8bc6\uff1a")),Object(r.b)("ol",null,Object(r.b)("li",{parentName:"ol"},"\u6700\u597d\u4f7f\u7528\u8fc7hook"),Object(r.b)("li",{parentName:"ol"},"\u6709js\u57fa\u7840\uff0c\u7406\u89e3\u95ed\u5305\u548c\u4e8b\u4ef6\u5faa\u73af")),Object(r.b)("h2",{id:"2-hook\u539f\u7406"},"2. hook\u539f\u7406"),Object(r.b)("ul",null,Object(r.b)("li",{parentName:"ul"},Object(r.b)("strong",{parentName:"li"},"\u8bf4\u5728\u524d\u9762"),"\uff1a\u539f\u7406\u4e0d\u662f\u6e90\u7801\uff0c\u539f\u7406\u53ea\u662f\u7528\u66f4\u597d\u7406\u89e3\u7684\u65b9\u6cd5\uff0c\u4f53\u73b0\u51fa\u6e90\u7801\u7684\u601d\u7ef4\uff0c\u8ddf\u6e90\u7801\u8fd8\u662f\u6709\u4e00\u5b9a\u533a\u522b\u7684\u3002\u539f\u7406\u5b66\u4e60\u8fc7\u540e\uff0c\u4e5f\u4f1a\u5bf9\u81ea\u5df1\u4e66\u5199\u7684\u4e00\u4e9b\u4ee3\u7801\u66f4\u52a0\u7406\u89e3\u3002")),Object(r.b)("h3",{id:"21-usestate"},"2.1 useState"),Object(r.b)("ul",null,Object(r.b)("li",{parentName:"ul"},"\u5148\u5199\u4e00\u4e2auseState\u65b9\u6cd5")),Object(r.b)("pre",null,Object(r.b)("code",{parentName:"pre",className:"language-js"},'import React from "react";\nimport ReactDOM from "react-dom";\nfunction hooks() {\n    let lastState;  // \u5b9a\u4e49\u4e00\u4e2a\u53d8\u91cf, \u8bb0\u5f55\u72b6\u6001\u503c\n    function useState(initValue) {\n        // \u5982\u679c\u6709\u4e0a\u4e00\u4e2a\u5c31\u7528\u4e0a\u4e00\u4e2a\u6ca1\u6709\u5c31\u7528\u521d\u59cb\u503c\n        lastState = lastState || initValue;\n        const setState = (newState) => {  // \u5b9a\u4e49\u4e00\u4e2a\u65b9\u6cd5\n            lastState = newState;  // \u628a\u6700\u65b0\u503c\u8d4b\u503c\n            render()  // \u6e32\u67d3\u7ec4\u4ef6\n        }\n        /* \u8fd4\u56de\u6700\u65b0\u503c\u548c\u8bbe\u7f6e\u51fd\u6570 */\n        return [lastState, setState]\n    }\n    return {\n       useState // \u8fd4\u56de\u65b9\u6cd5\n    }\n}\nlet { useState } = hooks();\n\nconst App = () => {\n    const [number, setNumber] = useState(0)\n\n    const handleClick = () => {\n        setNumber(number + 1)\n    }\n\n    return <div>\n        <p>{number}</p>\n        <button onClick={handleClick}>+</button>\n    </div>\n}\nrender()\n\nfunction render() {\n    ReactDOM.render(<App />, document.getElementById("root"));\n}\n')),Object(r.b)("ul",null,Object(r.b)("li",{parentName:"ul"},Object(r.b)("p",{parentName:"li"},"\u8fd9\u91cc\u8981\u8bf4\u4e00\u4e0b\uff0c",Object(r.b)("inlineCode",{parentName:"p"},"react"),"\u4e2d",Object(r.b)("inlineCode",{parentName:"p"},"class"),"\u7ec4\u4ef6\u4f7f\u7528\u5b9e\u4f8b\u50a8\u5b58\u72b6\u6001\uff0c\u90a3\u51fd\u6570\u7ec4\u4ef6\u7684\u72b6\u6001\u662f\u5b58\u5728\u54ea\u91cc\u7684\u5462\uff1f\u7b54\u6848\u662f\uff1a\u51fd\u6570\u7ec4\u4ef6\u5bf9\u5e94\u7684",Object(r.b)("inlineCode",{parentName:"p"},"fiber"),"\u4e2d \u6709\u4e2a",Object(r.b)("inlineCode",{parentName:"p"},"memoizedState"),"\u662f\u4e00\u4e2a\u94fe\u8868\u7ed3\u6784\uff0c\u4e13\u95e8\u7528\u6765\u5b58\u8d2e",Object(r.b)("inlineCode",{parentName:"p"},"hook"),"\u7684\u72b6\u6001\u6570\u636e\u3002\u8fd9\u6b21\u6211\u4eec\u53ea\u662f\u8bb2\u539f\u7406\uff0c\u5bf9\u6e90\u7801\u4e0d\u505a\u8fc7\u591a\u8ba8\u8bba\uff0c\u6709\u5174\u8da3\u53ef\u4ee5\u770b\u5361\u9882\u5927\u4f6c\u5199\u7684",Object(r.b)("a",{parentName:"p",href:"https://react.iamkasong.com/"},"React\u6280\u672f\u63ed\u79d8"),"\u3002")),Object(r.b)("li",{parentName:"ul"},Object(r.b)("p",{parentName:"li"},"\u8fd9\u6837\u770b",Object(r.b)("inlineCode",{parentName:"p"},"setState"),"\u662f\u4e0d\u662f\u89c9\u5f97\u5f88\u7b80\u5355\u5462\u3002\u73b0\u5728\u53c8\u6709\u4e00\u4e2a\u95ee\u9898\u4ea7\u751f\u4e86\u3002\u5982\u679c\u6211\u5728\u4ee3\u7801\u4e2d\u540c\u65f6\u8c03\u7528\u4e24\u4e2a",Object(r.b)("inlineCode",{parentName:"p"},"useState"),"\u600e\u4e48\u529e\u5462\uff0c\u8fd9\u6837\u4e0d\u662f\u90fd\u8986\u76d6\u6389\u4e86\u3002\u73b0\u5728\u8ba9\u6211\u4eec\u6765\u6539\u9020\u4e00\u4e0b\u6211\u4eec\u7684",Object(r.b)("inlineCode",{parentName:"p"},"useState"),"\u65b9\u6cd5\u3002"))),Object(r.b)("pre",null,Object(r.b)("code",{parentName:"pre",className:"language-js"},'import React from "react";\nimport ReactDOM from "react-dom";\nfunction hooks() {\n  let hookStates = []; // \u4fdd\u5b58\u6240\u6709\u72b6\u6001\u7684\u6570\u7ec4\n  let hookIndex = 0;  // \u7d22\u5f15\n  function useState(initValue) {\n    // \u628a\u6bcf\u4e00\u4e2a\u72b6\u6001\u5b58\u5165\u5f53\u524d\u7684\u72b6\u6001\u6570\u7ec4\u91cc\u9762\n    hookStates[hookIndex] = hookStates[hookIndex] || initValue;\n    let currentIndex = hookIndex;  // \u5907\u4efd\u4e00\u4e9b\u5f53\u524d\u7684\u7d22\u5f15\u503c\n    const setState = (newState) => {\n      // \u5728\u95ed\u5305\u51fd\u6570\u4e2d\u4f7f\u7528\uff0c\u6bcf\u6b21setState\u90fd\u662f\u5f53\u524d\u95ed\u5305\u73af\u5883\u4e0b\u7684\u503c\n      hookStates[currentIndex] = newState;\n      render(); // \u91cd\u65b0\u6e32\u67d3\u7ec4\u4ef6\n    }\n    /* \u8fd4\u56de\u65b9\u6cd5\u6570\u7ec4\uff0c\u7d22\u5f15 + 1 */\n    return [hookStates[hookIndex++], setState];\n  }\n\n  // \u51fd\u6570\u6bcf\u6b21\u6e32\u67d3\u4e4b\u540e\uff0c\u91cd\u65b0\u8bbe\u7f6e\u7d22\u5f15\u4e3a1\u3002\n  function setHookIndex() {\n    hookIndex = 0;\n  }\n\n  return {\n    setHookIndex,\n    useState, // \u8fd4\u56de\u65b9\u6cd5\n  };\n}\nlet { useState, setHookIndex } = hooks();\n\nconst App = () => {\n  const [number, setNumber] = useState(0);\n  const [number1, setNumber1] = useState(0);\n\n  return (\n    <div>\n      <p>{number}</p>\n      <button onClick={() => setNumber(number + 1)}> + </button>\n      <p>{number1}</p>\n      <button onClick={() => setNumber1(number1 + 2)}> + </button>\n    </div>\n  );\n};\nrender();\n\nfunction render() {\n  setHookIndex(); // \u6bcf\u6b21\u6e32\u67d3\u91cd\u65b0\u8bbe\u7f6e\u7d22\u5f15\u4e3a0\n  ReactDOM.render(<App />, document.getElementById("root"));\n}\n')),Object(r.b)("ul",null,Object(r.b)("li",{parentName:"ul"},"\u8fd9\u6b21\u7684\u6539\u9020\uff0c\u53bb\u6389\u4e86\u4e4b\u524d\u5b58\u4e00\u4e2a\u53d8\u91cf\u503c\u7684",Object(r.b)("inlineCode",{parentName:"li"},"lastState"),"\uff0c\u6539\u4e3a\u4e86",Object(r.b)("inlineCode",{parentName:"li"},"hookStates"),"\u6570\u7ec4 \u548c ",Object(r.b)("inlineCode",{parentName:"li"},"hookIndex"),"\u4e24\u4e2a\u503c\u3002\u4e00\u4e2a\u7528\u6765\u8bb0\u5f55\u5f53\u524d\u7684\u72b6\u6001\uff0c\u4e00\u4e2a\u7528\u6765\u8bb0\u5f55\u5f53\u524d\u7684\u4e0b\u6807\u503c\u3002\u6e90\u7801\u4e2d\u7684\u5b9e\u73b0\u4f7f\u7528\u94fe\u8868\u8fdb\u884c",Object(r.b)("inlineCode",{parentName:"li"},"next"),"\u6307\u5411\u4e0b\u4e00\u4e2a\uff0c\u4f46\u662f\u57fa\u672c\u539f\u7406\u5c31\u5dee\u4e0d\u591a\u3002\u8fd9\u5c31\u662f\u4e3a\u4ec0\u4e48\uff0c\u4e0d\u53ef\u4ee5\u5728",Object(r.b)("inlineCode",{parentName:"li"},"if"),"\u8bed\u53e5\u4e2d\u4f7f\u7528",Object(r.b)("inlineCode",{parentName:"li"},"hook"),"\u51fd\u6570\u3002\u63a5\u4e0b\u6765\u8ba9\u6211\u4eec\u6765\u770b\u4e00\u4e0b\u5728",Object(r.b)("inlineCode",{parentName:"li"},"hook"),"\u4e2d\u5904\u7406\u526f\u4f5c\u7528\u7684\u94a9\u5b50\u51fd\u6570",Object(r.b)("inlineCode",{parentName:"li"},"useEffect"))),Object(r.b)("h3",{id:"22-useeffect"},"2.2 useEffect"),Object(r.b)("ul",null,Object(r.b)("li",{parentName:"ul"},"\u8fd9\u4e2a\u51fd\u6570\u4e3b\u8981\u662f\u4e3a\u4e86\u5904\u7406\u51fd\u6570\u4e2d\u6709\u4e00\u4e9b\u526f\u4f5c\u7528\uff0c\u5728",Object(r.b)("inlineCode",{parentName:"li"},"class"),"\u7ec4\u4ef6\u7684\u65f6\u5019\uff0c\u6211\u4eec\u90fd\u662f\u7528\u751f\u547d\u5468\u671f\u505a\u5904\u7406\u7684\uff0c\u6bd4\u5982\u8bf4\u53d1\u9001\u8bf7\u6c42\u66f4\u6539",Object(r.b)("inlineCode",{parentName:"li"},"dom"),"\u4e4b\u7c7b\u7684\u5904\u7406\uff0c\u51fd\u6570\u7ec4\u4ef6\u4e2d",Object(r.b)("inlineCode",{parentName:"li"},"react"),"\u7ed9\u6211\u4eec\u63d0\u4f9b\u4e86",Object(r.b)("inlineCode",{parentName:"li"},"useEffect"),"\u8fd9\u4e2a\u51fd\u6570\u3002\u8ba9\u6211\u4eec\u6765\u770b\u770b\u4ed6\u7684\u539f\u7406\u662f\u4ec0\u4e48\u5427\uff01")),Object(r.b)("pre",null,Object(r.b)("code",{parentName:"pre",className:"language-js"},'import React from "react";\nimport ReactDOM from "react-dom";\nfunction hooks() {\n  let hookStates = []; // \u4fdd\u5b58\u6240\u6709\u72b6\u6001\u7684\u6570\u7ec4\n  let hookIndex = 0;  // \u7d22\u5f15\n  function useState(initValue) {\n    // \u628a\u6bcf\u4e00\u4e2a\u72b6\u6001\u5b58\u5165\u5f53\u524d\u7684\u72b6\u6001\u6570\u7ec4\u91cc\u9762\n    hookStates[hookIndex] = hookStates[hookIndex] || initValue;\n    let currentIndex = hookIndex;  // \u5907\u4efd\u4e00\u4e9b\u5f53\u524d\u7684\u7d22\u5f15\u503c\n    const setState = (newState) => {\n      // \u5728\u95ed\u5305\u51fd\u6570\u4e2d\u4f7f\u7528\uff0c\u6bcf\u6b21setState\u90fd\u662f\u5f53\u524d\u95ed\u5305\u73af\u5883\u4e0b\u7684\u503c\n      hookStates[currentIndex] = newState;\n      render(); // \u91cd\u65b0\u6e32\u67d3\u7ec4\u4ef6\n    }\n    /* \u8fd4\u56de\u65b9\u6cd5\u6570\u7ec4\uff0c\u7d22\u5f15 + 1 */\n    return [hookStates[hookIndex++], setState];\n  }\n\n  function useEffect(fn, deps) {\n    /* \u5982\u679c\u6709\u4e0a\u4e00\u6b21\u6709\u5b58\u5728useEffect\uff0c\u5c31\u4ecehookState\u91cc\u9762\u53d6\u503c */\n    if(hookStates[hookIndex]) {\n      let [oldDestroy, lastDeps] = hookStates[hookIndex];\n      /* \u5224\u65ad\u4f9d\u8d56\u9879\u662f\u5426\u76f8\u540c */\n      let same = deps.every((item, index) => item === lastDeps[index]);\n      if(same) {\n        hookIndex ++;  // \u5982\u679c\u76f8\u540c\uff0c\u53ea\u52a0\u7d22\u5f15\uff0c\u4e0d\u8fdb\u884c\u5176\u4ed6\u64cd\u4f5c\n      } else {\n        /* \u5982\u679c\u4e0d\u540c\uff0c\u73b0\u6267\u884c\u4e0a\u4e00\u6b21\u7684\u8fd4\u56de\u503c */\n        oldDestroy();\n        /* \u5f00\u542f\u4e00\u4e2a\u5b8f\u4efb\u52a1 */\n        setTimeout(()=>{\n          let destroy = fn();  // \u6267\u884c\u53d6\u8fd4\u56de\u503c\n          hookStates[hookIndex++] = [destroy, deps]; // \u8d4b\u503c\n        });\n      }\n    } else {\n      /* \u5f00\u542f\u4e00\u4e2a\u5b8f\u4efb\u52a1 */\n      setTimeout(()=>{\n        let destroy = fn();  // \u6267\u884c\u53d6\u8fd4\u56de\u503c\n        hookStates[hookIndex++] = [destroy, deps]; // \u8d4b\u503c\n      });\n    }\n  }\n\n  // \u51fd\u6570\u6bcf\u6b21\u6e32\u67d3\u4e4b\u540e\uff0c\u91cd\u65b0\u8bbe\u7f6e\u7d22\u5f15\u4e3a1\u3002\n  function setHookIndex() {\n    hookIndex = 0;\n  }\n\n  return {\n    setHookIndex,\n    useState, // \u8fd4\u56de\u65b9\u6cd5\n    useEffect,\n  };\n}\nlet { useState, useEffect, setHookIndex } = hooks();\n\nconst App = () => {\n  const [number, setNumber] = useState(0);\n\n  useEffect(() => {\n    document.title = number;\n    return () => {\n      console.log(\'\u9500\u6bc1\');\n    }\n  }, [number])\n\n  return (\n    <div>\n      <p>number: {number}</p>\n      <button onClick={() => setNumber(number + 1)}> + </button>\n    </div>\n  );\n};\nrender();\n\nfunction render() {\n  setHookIndex(); // \u6e32\u67d3\u540e\u91cd\u65b0\u8bbe\u7f6e\u7d22\u5f15\u4e3a1\n  ReactDOM.render(<App />, document.getElementById("root"));\n}\n')),Object(r.b)("ul",null,Object(r.b)("li",{parentName:"ul"},"\u4e0a\u9762\u7684\u5b9e\u73b0\u4e2d\u6211\u4eec\u53ef\u4ee5\u770b\u5230useEffect\u7684\u539f\u7406\uff0c\u4ed6\u662f\u5f00\u542f\u4e86\u4e00\u4e2a\u5b8f\u4efb\u52a1\uff0c\u90a3\u4e48\u5c31\u4e0d\u5f97\u4e0d\u63d0\u5230\u8ddf\u8fd9\u4e2a\u51fd\u6570\u5f88\u7c7b\u4f3c\u7684\u4e00\u4e2a\u51fd\u6570",Object(r.b)("inlineCode",{parentName:"li"},"useLayoutEffect"),"\u3002")),Object(r.b)("h3",{id:"23-uselayouteffect"},"2.3 useLayoutEffect"),Object(r.b)("ul",null,Object(r.b)("li",{parentName:"ul"},"\u6765\u770b\u770b\u4e0b\u9762\u8fd9\u4e2a\u4f8b\u5b50\u3002")),Object(r.b)("pre",null,Object(r.b)("code",{parentName:"pre",className:"language-js"},'import React, { useRef } from "react";\nimport ReactDOM from "react-dom";\nfunction hooks() {\n  let hookStates = []; // \u4fdd\u5b58\u6240\u6709\u72b6\u6001\u7684\u6570\u7ec4\n  let hookIndex = 0; // \u7d22\u5f15\n  function useState(initValue) {\n    // \u628a\u6bcf\u4e00\u4e2a\u72b6\u6001\u5b58\u5165\u5f53\u524d\u7684\u72b6\u6001\u6570\u7ec4\u91cc\u9762\n    hookStates[hookIndex] = hookStates[hookIndex] || initValue;\n    let currentIndex = hookIndex; // \u5907\u4efd\u4e00\u4e9b\u5f53\u524d\u7684\u7d22\u5f15\u503c\n    const setState = (newState) => {\n      // \u5728\u95ed\u5305\u51fd\u6570\u4e2d\u4f7f\u7528\uff0c\u6bcf\u6b21setState\u90fd\u662f\u5f53\u524d\u95ed\u5305\u73af\u5883\u4e0b\u7684\u503c\n      hookStates[currentIndex] = newState;\n      render(); // \u91cd\u65b0\u6e32\u67d3\u7ec4\u4ef6\n    };\n    /* \u8fd4\u56de\u65b9\u6cd5\u6570\u7ec4\uff0c\u7d22\u5f15 + 1 */\n    return [hookStates[hookIndex++], setState];\n  }\n\n  function useEffect(fn, deps) {\n    /* \u5982\u679c\u6709\u4e0a\u4e00\u6b21\u6709\u5b58\u5728useEffect\uff0c\u5c31\u4ecehookState\u91cc\u9762\u53d6\u503c */\n    if (hookStates[hookIndex]) {\n      let [oldDestroy, lastDeps] = hookStates[hookIndex];\n      /* \u5224\u65ad\u4f9d\u8d56\u9879\u662f\u5426\u76f8\u540c */\n      let same = deps.every((item, index) => item === lastDeps[index]);\n      if (same) {\n        hookIndex++; // \u5982\u679c\u76f8\u540c\uff0c\u53ea\u52a0\u7d22\u5f15\uff0c\u4e0d\u8fdb\u884c\u5176\u4ed6\u64cd\u4f5c\n      } else {\n        /* \u5982\u679c\u4e0d\u540c\uff0c\u73b0\u6267\u884c\u4e0a\u4e00\u6b21\u7684\u8fd4\u56de\u503c */\n        oldDestroy();\n        /* \u5f00\u542f\u4e00\u4e2a\u5b8f\u4efb\u52a1 */\n        setTimeout(() => {\n          let destroy = fn(); // \u6267\u884c\u53d6\u8fd4\u56de\u503c\n          hookStates[hookIndex++] = [destroy, deps]; // \u8d4b\u503c\n        });\n      }\n    } else {\n      /* \u5f00\u542f\u4e00\u4e2a\u5b8f\u4efb\u52a1 */\n      setTimeout(() => {\n        let destroy = fn(); // \u6267\u884c\u53d6\u8fd4\u56de\u503c\n        hookStates[hookIndex++] = [destroy, deps]; // \u8d4b\u503c\n      });\n    }\n  }\n  function useLayoutEffect(fn, deps) {\n    /* \u5982\u679c\u6709\u4e0a\u4e00\u6b21\u6709\u5b58\u5728useEffect\uff0c\u5c31\u4ecehookState\u91cc\u9762\u53d6\u503c */\n    if (hookStates[hookIndex]) {\n      let [oldDestroy, lastDeps] = hookStates[hookIndex];\n      /* \u5224\u65ad\u4f9d\u8d56\u9879\u662f\u5426\u76f8\u540c */\n      let same = deps.every((item, index) => item === lastDeps[index]);\n      if (same) {\n        hookIndex++; // \u5982\u679c\u76f8\u540c\uff0c\u53ea\u52a0\u7d22\u5f15\uff0c\u4e0d\u8fdb\u884c\u5176\u4ed6\u64cd\u4f5c\n      } else {\n        /* \u5982\u679c\u4e0d\u540c\uff0c\u73b0\u6267\u884c\u4e0a\u4e00\u6b21\u7684\u8fd4\u56de\u503c */\n        oldDestroy();\n        /* \u5f00\u542f\u4e00\u4e2a\u5fae\u4efb\u52a1 */\n        queueMicrotask(() => {\n          let destroy = fn(); // \u6267\u884c\u53d6\u8fd4\u56de\u503c\n          hookStates[hookIndex++] = [destroy, deps]; // \u8d4b\u503c\n        });\n      }\n    } else {\n      /* \u5f00\u542f\u4e00\u4e2a\u5fae\u4efb\u52a1 */\n      queueMicrotask(() => {\n        let destroy = fn(); // \u6267\u884c\u53d6\u8fd4\u56de\u503c\n        hookStates[hookIndex++] = [destroy, deps]; // \u8d4b\u503c\n      });\n    }\n  }\n\n  // \u51fd\u6570\u6bcf\u6b21\u6e32\u67d3\u4e4b\u540e\uff0c\u91cd\u65b0\u8bbe\u7f6e\u7d22\u5f15\u4e3a1\u3002\n  function setHookIndex() {\n    hookIndex = 0;\n  }\n\n  return {\n    setHookIndex,\n    useState, // \u8fd4\u56de\u65b9\u6cd5\n    useEffect,\n    useLayoutEffect\n  };\n}\nlet { setHookIndex, useState, useEffect, useLayoutEffect } = hooks();\n\nconst App = () => {\n  // useRef\u4e5f\u662f\u4e00\u4e2a\u94a9\u5b50\uff0c\u8fd9\u4e2a\u94a9\u5b50\u662freact\u5728\u865a\u62dfdom\u8f6c\u6362\u6210\u771f\u5b9edom\u7684\u662f\u6302\u8f7d\u5230react\u7684ref\u5c5e\u6027\u4e0a\u7684\u5bf9\u8c61\n  let greenRef = useRef();  // {current: null}\n  let redRef = useRef();\n\n  useEffect(() => {\n    greenRef.current.style.transform = \'translate(500px)\'\n    greenRef.current.style.transition = \'all 500ms\'\n  }, []);\n\n  useLayoutEffect(() => {\n    redRef.current.style.transform = \'translate(500px)\'\n    redRef.current.style.transition = \'all 500ms\'\n  }, [])\n\n  function style(color) {\n    return {\n      width: "200px",\n      height: "200px",\n      backgroundColor: color,\n    };\n  }\n\n  return (\n    <div>\n      <p ref={greenRef} style={style("green")}></p>\n      <p ref={redRef} style={style("red")}></p>\n    </div>\n  );\n};\nrender();\n\nfunction render() {\n  setHookIndex(); // \u6e32\u67d3\u540e\u91cd\u65b0\u8bbe\u7f6e\u7d22\u5f15\u4e3a1\n  ReactDOM.render(<App />, document.getElementById("root"));\n}\n')),Object(r.b)("ul",null,Object(r.b)("li",{parentName:"ul"},"\u8fd9\u4e24\u4e2a\u94a9\u5b50\u539f\u7406\u57fa\u672c\u5dee\u4e0d\u591a\uff0c\u53ea\u4e0d\u8fc7\u5728\u6267\u884c\u65f6\u673a\u6709\u4e9b\u4e0d\u4e00\u6837\u3002\u8fd9\u6837\u4f7f\u7528\u8d77\u6765\u662f\u4e0d\u662f\u66f4\u52a0\u5f97\u5fc3\u5e94\u624b\u4e86\u5462\uff1f\u5176\u5b9ereact-hook\uff0c\u5e38\u7528\u7684\u4e5f\u5c31state \u548c effect\uff0c\u4e0b\u9762\u6211\u4eec\u6765\u770b\u51e0\u4e2a\u4f18\u5316\u6e32\u67d3\u7684\u94a9\u5b50\u51fd\u6570\u3002")),Object(r.b)("h3",{id:"24-usememo-\u548c-usecallback"},"2.4 useMemo \u548c useCallback"),Object(r.b)("pre",null,Object(r.b)("code",{parentName:"pre",className:"language-js"},'import React, { useRef } from "react";\nimport ReactDOM from "react-dom";\nfunction hooks() {\n  let hookStates = []; // \u4fdd\u5b58\u6240\u6709\u72b6\u6001\u7684\u6570\u7ec4\n  let hookIndex = 0; // \u7d22\u5f15\n  function useState(initValue) {\n    // \u628a\u6bcf\u4e00\u4e2a\u72b6\u6001\u5b58\u5165\u5f53\u524d\u7684\u72b6\u6001\u6570\u7ec4\u91cc\u9762\n    hookStates[hookIndex] = hookStates[hookIndex] || initValue;\n    let currentIndex = hookIndex; // \u5907\u4efd\u4e00\u4e9b\u5f53\u524d\u7684\u7d22\u5f15\u503c\n    const setState = (newState) => {\n      // \u5728\u95ed\u5305\u51fd\u6570\u4e2d\u4f7f\u7528\uff0c\u6bcf\u6b21setState\u90fd\u662f\u5f53\u524d\u95ed\u5305\u73af\u5883\u4e0b\u7684\u503c\n      hookStates[currentIndex] = newState;\n      render(); // \u91cd\u65b0\u6e32\u67d3\u7ec4\u4ef6\n    };\n    /* \u8fd4\u56de\u65b9\u6cd5\u6570\u7ec4\uff0c\u7d22\u5f15 + 1 */\n    return [hookStates[hookIndex++], setState];\n  }\n\n  function useEffect(fn, deps) {\n    /* \u5982\u679c\u6709\u4e0a\u4e00\u6b21\u6709\u5b58\u5728useEffect\uff0c\u5c31\u4ecehookState\u91cc\u9762\u53d6\u503c */\n    if (hookStates[hookIndex]) {\n      let [oldDestroy, lastDeps] = hookStates[hookIndex];\n      /* \u5224\u65ad\u4f9d\u8d56\u9879\u662f\u5426\u76f8\u540c */\n      let same = deps.every((item, index) => item === lastDeps[index]);\n      if (same) {\n        hookIndex++; // \u5982\u679c\u76f8\u540c\uff0c\u53ea\u52a0\u7d22\u5f15\uff0c\u4e0d\u8fdb\u884c\u5176\u4ed6\u64cd\u4f5c\n      } else {\n        /* \u5982\u679c\u4e0d\u540c\uff0c\u73b0\u6267\u884c\u4e0a\u4e00\u6b21\u7684\u8fd4\u56de\u503c */\n        oldDestroy();\n        /* \u5f00\u542f\u4e00\u4e2a\u5b8f\u4efb\u52a1 */\n        setTimeout(() => {\n          let destroy = fn(); // \u6267\u884c\u53d6\u8fd4\u56de\u503c\n          hookStates[hookIndex++] = [destroy, deps]; // \u8d4b\u503c\n        });\n      }\n    } else {\n      /* \u5f00\u542f\u4e00\u4e2a\u5b8f\u4efb\u52a1 */\n      setTimeout(() => {\n        let destroy = fn(); // \u6267\u884c\u53d6\u8fd4\u56de\u503c\n        hookStates[hookIndex++] = [destroy, deps]; // \u8d4b\u503c\n      });\n    }\n  }\n  function useLayoutEffect(fn, deps) {\n    /* \u5982\u679c\u6709\u4e0a\u4e00\u6b21\u6709\u5b58\u5728useEffect\uff0c\u5c31\u4ecehookState\u91cc\u9762\u53d6\u503c */\n    if (hookStates[hookIndex]) {\n      let [oldDestroy, lastDeps] = hookStates[hookIndex];\n      /* \u5224\u65ad\u4f9d\u8d56\u9879\u662f\u5426\u76f8\u540c */\n      let same = deps.every((item, index) => item === lastDeps[index]);\n      if (same) {\n        hookIndex++; // \u5982\u679c\u76f8\u540c\uff0c\u53ea\u52a0\u7d22\u5f15\uff0c\u4e0d\u8fdb\u884c\u5176\u4ed6\u64cd\u4f5c\n      } else {\n        /* \u5982\u679c\u4e0d\u540c\uff0c\u73b0\u6267\u884c\u4e0a\u4e00\u6b21\u7684\u8fd4\u56de\u503c */\n        oldDestroy();\n        /* \u5f00\u542f\u4e00\u4e2a\u5fae\u4efb\u52a1 */\n        queueMicrotask(() => {\n          let destroy = fn(); // \u6267\u884c\u53d6\u8fd4\u56de\u503c\n          hookStates[hookIndex++] = [destroy, deps]; // \u8d4b\u503c\n        });\n      }\n    } else {\n      /* \u5f00\u542f\u4e00\u4e2a\u5fae\u4efb\u52a1 */\n      queueMicrotask(() => {\n        let destroy = fn(); // \u6267\u884c\u53d6\u8fd4\u56de\u503c\n        hookStates[hookIndex++] = [destroy, deps]; // \u8d4b\u503c\n      });\n    }\n  }\n\n  function useMemo(fn, deps) {\n    if (hookStates[hookIndex]) {\n      let [oldMemo, lastDeps] = hookStates[hookIndex]\n      /* \u5224\u65ad\u4f9d\u8d56\u9879\u662f\u5426\u76f8\u540c */\n      let same = deps.every((item, index) => item === lastDeps[index]);\n      if(same) {\n        hookIndex ++;\n        return oldMemo;  // \u8fd4\u56de\u8001\u7684\u503c\n      } else { \n        let newMemo = fn()  // \u8ba1\u7b97\u65b0\u7684\u503c\n        hookStates[hookIndex++] = [newMemo, deps];\n        return newMemo;\n      }\n    } else {\n      let newMemo = fn()\n      hookStates[hookIndex++] = [newMemo, deps];\n      return newMemo;\n    }\n  }\n  function useCallback(fn, deps) {\n    if (hookStates[hookIndex]) {\n      let [oldfn, lastDeps] = hookStates[hookIndex]\n      /* \u5224\u65ad\u4f9d\u8d56\u9879\u662f\u5426\u76f8\u540c */\n      let same = deps.every((item, index) => item === lastDeps[index]);\n      if(same) {\n        hookIndex ++;\n        return oldfn;  // \u76f4\u63a5\u8fd4\u56de\u8001\u7684\u51fd\u6570\n      } else {\n        hookStates[hookIndex++] = [fn, deps];\n        return fn;\n      }\n    } else {\n      hookStates[hookIndex++] = [fn, deps];\n      return fn;\n    }\n  }\n\n  function memo(OldFunctionComponent) {\n    return class extends React.PureComponent{\n      render() {\n        return <OldFunctionComponent  {...this.props}/>\n      }\n    }\n  }\n\n  // \u51fd\u6570\u6bcf\u6b21\u6e32\u67d3\u4e4b\u540e\uff0c\u91cd\u65b0\u8bbe\u7f6e\u7d22\u5f15\u4e3a1\u3002\n  function setHookIndex() {\n    hookIndex = 0;\n  }\n\n  return {\n    setHookIndex,\n    useState, // \u8fd4\u56de\u65b9\u6cd5\n    useEffect,\n    useLayoutEffect,\n    useMemo,\n    useCallback,\n    memo\n  };\n}\nlet { setHookIndex, useState, useEffect, useLayoutEffect, useMemo, useCallback, memo } = hooks();\n\nlet Child = ({data, addNumber}) => {\n  console.log(\'child render\');\n  return <button onClick={addNumber}>{data.number}</button>\n}\n\nChild = memo(Child);\n\nconst App = () => {\n  const [value, setValue] = useState(\'\');\n  const [number, setNumber] = useState(0);\n  let data = useMemo(() => ({number}), [number])\n  // let data = {number};\n  let addNumber = useCallback(() => setNumber(number + 1), [number])\n  // let addNumber = () => setNumber(number + 1)\n\n  // let lastData = data;\n  // console.log(data === lastData); // true\n\n  return <div>\n    <input type="text" value={value} onChange={(e) => setValue(e.target.value)} />\n    <Child data={data} addNumber={addNumber}/>\n  </div>\n};\n\nrender();\n\nfunction render() {\n  setHookIndex(); // \u6e32\u67d3\u540e\u91cd\u65b0\u8bbe\u7f6e\u7d22\u5f15\u4e3a1\n  ReactDOM.render(<App />, document.getElementById("root"));\n}\n')),Object(r.b)("ul",null,Object(r.b)("li",{parentName:"ul"},"\u8fd9\u4e24\u4e2a\u51fd\u6570\u914d\u5408memo\u65b9\u6cd5\u7528\u6765\u51cf\u5c11react\u7ec4\u4ef6\u7684\u6e32\u67d3\u6b21\u6570\uff0cmemo\u53ea\u4f1a\u6bd4\u8f83\u6570\u636e\u7684\u5f15\u7528\u5730\u5740\uff0cuseCallback \u548c uesMemo \u5982\u679c\u6570\u636e\u6ca1\u6709\u53d8\uff0c\u5c31\u8fd4\u56de\u5f53\u524d\u7684\u5f15\u7528\u5730\u5740\u7684\u6570\u636e\uff0c\u8fd9\u6837\u4f7f\u7528\u53ef\u4ee5\u8ba9\u5b50\u7ec4\u4ef6\u51cf\u5c11\u6e32\u67d3\u3002\u5355\u72ec\u4f7f\u7528\u7684\u8bdd\uff0c\u53ef\u4ee5\u90e8\u5206\u4f18\u5316\u3002")),Object(r.b)("h3",{id:"25-usecontext"},"2.5 useContext"),Object(r.b)("pre",null,Object(r.b)("code",{parentName:"pre",className:"language-js"},'import React, { useRef } from "react";\nimport ReactDOM from "react-dom";\nfunction hooks() {\n  let hookStates = []; // \u4fdd\u5b58\u6240\u6709\u72b6\u6001\u7684\u6570\u7ec4\n  let hookIndex = 0; // \u7d22\u5f15\n  function useState(initValue) {\n    // \u628a\u6bcf\u4e00\u4e2a\u72b6\u6001\u5b58\u5165\u5f53\u524d\u7684\u72b6\u6001\u6570\u7ec4\u91cc\u9762\n    hookStates[hookIndex] = hookStates[hookIndex] || initValue;\n    let currentIndex = hookIndex; // \u5907\u4efd\u4e00\u4e9b\u5f53\u524d\u7684\u7d22\u5f15\u503c\n    const setState = (newState) => {\n      // \u5728\u95ed\u5305\u51fd\u6570\u4e2d\u4f7f\u7528\uff0c\u6bcf\u6b21setState\u90fd\u662f\u5f53\u524d\u95ed\u5305\u73af\u5883\u4e0b\u7684\u503c\n      hookStates[currentIndex] = newState;\n      render(); // \u91cd\u65b0\u6e32\u67d3\u7ec4\u4ef6\n    };\n    /* \u8fd4\u56de\u65b9\u6cd5\u6570\u7ec4\uff0c\u7d22\u5f15 + 1 */\n    return [hookStates[hookIndex++], setState];\n  }\n\n  function useEffect(fn, deps) {\n    /* \u5982\u679c\u6709\u4e0a\u4e00\u6b21\u6709\u5b58\u5728useEffect\uff0c\u5c31\u4ecehookState\u91cc\u9762\u53d6\u503c */\n    if (hookStates[hookIndex]) {\n      let [oldDestroy, lastDeps] = hookStates[hookIndex];\n      /* \u5224\u65ad\u4f9d\u8d56\u9879\u662f\u5426\u76f8\u540c */\n      let same = deps.every((item, index) => item === lastDeps[index]);\n      if (same) {\n        hookIndex++; // \u5982\u679c\u76f8\u540c\uff0c\u53ea\u52a0\u7d22\u5f15\uff0c\u4e0d\u8fdb\u884c\u5176\u4ed6\u64cd\u4f5c\n      } else {\n        /* \u5982\u679c\u4e0d\u540c\uff0c\u73b0\u6267\u884c\u4e0a\u4e00\u6b21\u7684\u8fd4\u56de\u503c */\n        oldDestroy();\n        /* \u5f00\u542f\u4e00\u4e2a\u5b8f\u4efb\u52a1 */\n        setTimeout(() => {\n          let destroy = fn(); // \u6267\u884c\u53d6\u8fd4\u56de\u503c\n          hookStates[hookIndex++] = [destroy, deps]; // \u8d4b\u503c\n        });\n      }\n    } else {\n      /* \u5f00\u542f\u4e00\u4e2a\u5b8f\u4efb\u52a1 */\n      setTimeout(() => {\n        let destroy = fn(); // \u6267\u884c\u53d6\u8fd4\u56de\u503c\n        hookStates[hookIndex++] = [destroy, deps]; // \u8d4b\u503c\n      });\n    }\n  }\n  function useLayoutEffect(fn, deps) {\n    /* \u5982\u679c\u6709\u4e0a\u4e00\u6b21\u6709\u5b58\u5728useEffect\uff0c\u5c31\u4ecehookState\u91cc\u9762\u53d6\u503c */\n    if (hookStates[hookIndex]) {\n      let [oldDestroy, lastDeps] = hookStates[hookIndex];\n      /* \u5224\u65ad\u4f9d\u8d56\u9879\u662f\u5426\u76f8\u540c */\n      let same = deps.every((item, index) => item === lastDeps[index]);\n      if (same) {\n        hookIndex++; // \u5982\u679c\u76f8\u540c\uff0c\u53ea\u52a0\u7d22\u5f15\uff0c\u4e0d\u8fdb\u884c\u5176\u4ed6\u64cd\u4f5c\n      } else {\n        /* \u5982\u679c\u4e0d\u540c\uff0c\u73b0\u6267\u884c\u4e0a\u4e00\u6b21\u7684\u8fd4\u56de\u503c */\n        oldDestroy();\n        /* \u5f00\u542f\u4e00\u4e2a\u5fae\u4efb\u52a1 */\n        queueMicrotask(() => {\n          let destroy = fn(); // \u6267\u884c\u53d6\u8fd4\u56de\u503c\n          hookStates[hookIndex++] = [destroy, deps]; // \u8d4b\u503c\n        });\n      }\n    } else {\n      /* \u5f00\u542f\u4e00\u4e2a\u5fae\u4efb\u52a1 */\n      queueMicrotask(() => {\n        let destroy = fn(); // \u6267\u884c\u53d6\u8fd4\u56de\u503c\n        hookStates[hookIndex++] = [destroy, deps]; // \u8d4b\u503c\n      });\n    }\n  }\n\n  function useMemo(fn, deps) {\n    if (hookStates[hookIndex]) {\n      let [oldMemo, lastDeps] = hookStates[hookIndex]\n      /* \u5224\u65ad\u4f9d\u8d56\u9879\u662f\u5426\u76f8\u540c */\n      let same = deps.every((item, index) => item === lastDeps[index]);\n      if(same) {\n        hookIndex ++;\n        return oldMemo;  // \u8fd4\u56de\u8001\u7684\u503c\n      } else { \n        let newMemo = fn()  // \u8ba1\u7b97\u65b0\u7684\u503c\n        hookStates[hookIndex++] = [newMemo, deps];\n        return newMemo;\n      }\n    } else {\n      let newMemo = fn()\n      hookStates[hookIndex++] = [newMemo, deps];\n      return newMemo;\n    }\n  }\n  function useCallback(fn, deps) {\n    if (hookStates[hookIndex]) {\n      let [oldfn, lastDeps] = hookStates[hookIndex]\n      /* \u5224\u65ad\u4f9d\u8d56\u9879\u662f\u5426\u76f8\u540c */\n      let same = deps.every((item, index) => item === lastDeps[index]);\n      if(same) {\n        hookIndex ++;\n        return oldfn;  // \u76f4\u63a5\u8fd4\u56de\u8001\u7684\u51fd\u6570\n      } else {\n        hookStates[hookIndex++] = [fn, deps];\n        return fn;\n      }\n    } else {\n      hookStates[hookIndex++] = [fn, deps];\n      return fn;\n    }\n  }\n\n  function useContext(context) {\n    return context._currentValue;  // \u5728\u7ec4\u4ef6\u6e32\u67d3\u7684\u65f6\u5019\u5df2\u7ecf\u5b58\u597d\u4e86\uff0c\u7136\u540euseContext\u76f4\u63a5\u53d6\u51fa\u8fd4\u56de\u5c31\u53ef\u4ee5\u4e86\u3002\n  }\n\n  function memo(OldFunctionComponent) {\n    return class extends React.PureComponent{\n      render() {\n        return <OldFunctionComponent  {...this.props}/>\n      }\n    }\n  }\n\n  // \u51fd\u6570\u6bcf\u6b21\u6e32\u67d3\u4e4b\u540e\uff0c\u91cd\u65b0\u8bbe\u7f6e\u7d22\u5f15\u4e3a1\u3002\n  function setHookIndex() {\n    hookIndex = 0;\n  }\n\n  return {\n    setHookIndex,\n    useState, // \u8fd4\u56de\u65b9\u6cd5\n    useEffect,\n    useLayoutEffect,\n    useMemo,\n    useCallback,\n    useContext,\n    memo\n  };\n}\nlet { setHookIndex, useState, useEffect, useLayoutEffect, useMemo, useCallback, memo, useContext } = hooks();\n\n\nlet AppContext = React.createContext();\n\nconst Child = () => {\n  const {state, setState} = useContext(AppContext);\n  return <div>\n    <p>{state}</p>\n    <button onClick={() => setState(state + 1)}>+</button>\n  </div>\n}\n\nconst App = () => {\n  const [state, setState] = useState(0);\n  return <AppContext.Provider value={{state, setState}}>\n    <Child/>\n  </AppContext.Provider>\n};\n\nrender();\n\nfunction render() {\n  setHookIndex(); // \u6e32\u67d3\u540e\u91cd\u65b0\u8bbe\u7f6e\u7d22\u5f15\u4e3a1\n  ReactDOM.render(<App />, document.getElementById("root"));\n}\n')),Object(r.b)("ul",null,Object(r.b)("li",{parentName:"ul"},"\u53ef\u4ee5\u770b\u5230context\u7684\u539f\u7406\u975e\u5e38\u7b80\u5355\uff0c\u4ec5\u4ec5\u662f\u53d6\u51fareact\u5904\u7406\u8fc7\u7a0b\u4e2d\u5b58\u597d\u7684\u5c5e\u6027\uff0c\u76f4\u63a5\u8fd4\u56de\u3002\u8fd8\u60f3\u4e86\u89e3\u7684\u8bdd\u53ef\u4ee5\u770b\u4e00\u4e0b createContext\u3001Provider\u3001Consumer\uff0cuseContext\u53ea\u662f\u53d6\u51fa\u503c\u800c\u5df2\uff0c\u4e0d\u505a\u8fc7\u591a\u8bf4\u660e\u3002\u4e0b\u9762\u770b\u4e0buseReduer")),Object(r.b)("h3",{id:"26-usereducer"},"2.6 useReducer"),Object(r.b)("pre",null,Object(r.b)("code",{parentName:"pre",className:"language-js"},"import React, { useRef } from \"react\";\nimport ReactDOM from \"react-dom\";\nfunction hooks() {\n  let hookStates = []; // \u4fdd\u5b58\u6240\u6709\u72b6\u6001\u7684\u6570\u7ec4\n  let hookIndex = 0; // \u7d22\u5f15\n  /* \u6539\u9020useState\u4f7f\u7528 useReducer \u5b9e\u73b0\uff0cuseState\u5c31\u662fuseReducer\u7684\u8bed\u6cd5\u7cd6 */\n  function useState(initValue) {\n    return useReducer(null, initValue);\n  }\n\n  function useReducer(reducer, initValue) {\n    hookStates[hookIndex] = hookStates[hookIndex] || initValue;\n    let currentIndex = hookIndex;\n    const dispatch = (action) => {\n      // \u7528\u4f20\u5165\u7684reducer\u51fd\u6570\u53d6\u51fa\u6700\u65b0\u7684\u503c\n      // \u5982\u679c\u4f20\u5165\u7684\u662fnull\uff0c\u76f4\u63a5\u53d6\u51faaction\u7684\u503c\u5373\u53ef\n      hookStates[currentIndex] = reducer ? reducer(hookStates[currentIndex], action) : action;\n      render();\n    }\n    return [hookStates[hookIndex++], dispatch];\n  }\n\n  function useEffect(fn, deps) {\n    /* \u5982\u679c\u6709\u4e0a\u4e00\u6b21\u6709\u5b58\u5728useEffect\uff0c\u5c31\u4ecehookState\u91cc\u9762\u53d6\u503c */\n    if (hookStates[hookIndex]) {\n      let [oldDestroy, lastDeps] = hookStates[hookIndex];\n      /* \u5224\u65ad\u4f9d\u8d56\u9879\u662f\u5426\u76f8\u540c */\n      let same = deps.every((item, index) => item === lastDeps[index]);\n      if (same) {\n        hookIndex++; // \u5982\u679c\u76f8\u540c\uff0c\u53ea\u52a0\u7d22\u5f15\uff0c\u4e0d\u8fdb\u884c\u5176\u4ed6\u64cd\u4f5c\n      } else {\n        /* \u5982\u679c\u4e0d\u540c\uff0c\u73b0\u6267\u884c\u4e0a\u4e00\u6b21\u7684\u8fd4\u56de\u503c */\n        oldDestroy();\n        /* \u5f00\u542f\u4e00\u4e2a\u5b8f\u4efb\u52a1 */\n        setTimeout(() => {\n          let destroy = fn(); // \u6267\u884c\u53d6\u8fd4\u56de\u503c\n          hookStates[hookIndex++] = [destroy, deps]; // \u8d4b\u503c\n        });\n      }\n    } else {\n      /* \u5f00\u542f\u4e00\u4e2a\u5b8f\u4efb\u52a1 */\n      setTimeout(() => {\n        let destroy = fn(); // \u6267\u884c\u53d6\u8fd4\u56de\u503c\n        hookStates[hookIndex++] = [destroy, deps]; // \u8d4b\u503c\n      });\n    }\n  }\n  function useLayoutEffect(fn, deps) {\n    /* \u5982\u679c\u6709\u4e0a\u4e00\u6b21\u6709\u5b58\u5728useEffect\uff0c\u5c31\u4ecehookState\u91cc\u9762\u53d6\u503c */\n    if (hookStates[hookIndex]) {\n      let [oldDestroy, lastDeps] = hookStates[hookIndex];\n      /* \u5224\u65ad\u4f9d\u8d56\u9879\u662f\u5426\u76f8\u540c */\n      let same = deps.every((item, index) => item === lastDeps[index]);\n      if (same) {\n        hookIndex++; // \u5982\u679c\u76f8\u540c\uff0c\u53ea\u52a0\u7d22\u5f15\uff0c\u4e0d\u8fdb\u884c\u5176\u4ed6\u64cd\u4f5c\n      } else {\n        /* \u5982\u679c\u4e0d\u540c\uff0c\u73b0\u6267\u884c\u4e0a\u4e00\u6b21\u7684\u8fd4\u56de\u503c */\n        oldDestroy();\n        /* \u5f00\u542f\u4e00\u4e2a\u5fae\u4efb\u52a1 */\n        queueMicrotask(() => {\n          let destroy = fn(); // \u6267\u884c\u53d6\u8fd4\u56de\u503c\n          hookStates[hookIndex++] = [destroy, deps]; // \u8d4b\u503c\n        });\n      }\n    } else {\n      /* \u5f00\u542f\u4e00\u4e2a\u5fae\u4efb\u52a1 */\n      queueMicrotask(() => {\n        let destroy = fn(); // \u6267\u884c\u53d6\u8fd4\u56de\u503c\n        hookStates[hookIndex++] = [destroy, deps]; // \u8d4b\u503c\n      });\n    }\n  }\n\n  function useMemo(fn, deps) {\n    if (hookStates[hookIndex]) {\n      let [oldMemo, lastDeps] = hookStates[hookIndex]\n      /* \u5224\u65ad\u4f9d\u8d56\u9879\u662f\u5426\u76f8\u540c */\n      let same = deps.every((item, index) => item === lastDeps[index]);\n      if(same) {\n        hookIndex ++;\n        return oldMemo;  // \u8fd4\u56de\u8001\u7684\u503c\n      } else { \n        let newMemo = fn()  // \u8ba1\u7b97\u65b0\u7684\u503c\n        hookStates[hookIndex++] = [newMemo, deps];\n        return newMemo;\n      }\n    } else {\n      let newMemo = fn()\n      hookStates[hookIndex++] = [newMemo, deps];\n      return newMemo;\n    }\n  }\n  function useCallback(fn, deps) {\n    if (hookStates[hookIndex]) {\n      let [oldfn, lastDeps] = hookStates[hookIndex]\n      /* \u5224\u65ad\u4f9d\u8d56\u9879\u662f\u5426\u76f8\u540c */\n      let same = deps.every((item, index) => item === lastDeps[index]);\n      if(same) {\n        hookIndex ++;\n        return oldfn;  // \u76f4\u63a5\u8fd4\u56de\u8001\u7684\u51fd\u6570\n      } else {\n        hookStates[hookIndex++] = [fn, deps];\n        return fn;\n      }\n    } else {\n      hookStates[hookIndex++] = [fn, deps];\n      return fn;\n    }\n  }\n\n  function useContext(context) {\n    return context._currentValue\n  }\n\n  function memo(OldFunctionComponent) {\n    return class extends React.PureComponent{\n      render() {\n        return <OldFunctionComponent  {...this.props}/>\n      }\n    }\n  }\n\n  // \u51fd\u6570\u6bcf\u6b21\u6e32\u67d3\u4e4b\u540e\uff0c\u91cd\u65b0\u8bbe\u7f6e\u7d22\u5f15\u4e3a1\u3002\n  function setHookIndex() {\n    hookIndex = 0;\n  }\n\n  return {\n    setHookIndex,\n    useState, // \u8fd4\u56de\u65b9\u6cd5\n    useEffect,\n    useLayoutEffect,\n    useMemo,\n    useCallback,\n    useContext,\n    useReducer,\n    memo\n  };\n}\nlet { setHookIndex, useState, useEffect, useLayoutEffect, useMemo, useCallback, memo, useContext, useReducer } = hooks();\n\nfunction appReducer(state, action) {\n  switch (action.type) {\n    case 'ADD':\n      return state + 1;\n    case 'MINUS':\n      return state - 1;\n    default:\n      return state;\n  }\n}\n\nconst App = () => {\n  const [number, dispach] = useReducer(appReducer, 0)\n  const [count, setCount] = useState(10)\n  return <div>\n    <p>{number}</p>\n    <button onClick={() => dispach({type: 'ADD'})}> + </button>\n    <button onClick={() => dispach({type: 'MINUS'})}> - </button>\n    <button onClick={() => setCount(count + 1)}>{count}</button>\n  </div>\n};\n\nrender();\n\nfunction render() {\n  setHookIndex(); // \u6e32\u67d3\u540e\u91cd\u65b0\u8bbe\u7f6e\u7d22\u5f15\u4e3a1\n  ReactDOM.render(<App />, document.getElementById(\"root\"));\n}\n")),Object(r.b)("ul",null,Object(r.b)("li",{parentName:"ul"},"\u81f3\u6b64\uff0c\u57fa\u672c\u4e0a\u5e38\u7528\u7684hook\u539f\u7406\u90fd\u5df2\u7ecf\u8bf4\u8fc7\u4e86\uff0c\u4e0d\u77e5\u9053\u5927\u5bb6\u6709\u6ca1\u6709\u5bf9\u4e4b\u524d\u5199\u8fc7\u7684hook\u6709\u66f4\u6df1\u523b\u7684\u7406\u89e3\u3002")))}c.isMDXComponent=!0},134:function(e,n,t){"use strict";t.d(n,"a",(function(){return i})),t.d(n,"b",(function(){return f}));var o=t(0),s=t.n(o);function r(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function a(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);n&&(o=o.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,o)}return t}function u(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?a(Object(t),!0).forEach((function(n){r(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):a(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}function l(e,n){if(null==e)return{};var t,o,s=function(e,n){if(null==e)return{};var t,o,s={},r=Object.keys(e);for(o=0;o<r.length;o++)t=r[o],n.indexOf(t)>=0||(s[t]=e[t]);return s}(e,n);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(o=0;o<r.length;o++)t=r[o],n.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(s[t]=e[t])}return s}var d=s.a.createContext({}),c=function(e){var n=s.a.useContext(d),t=n;return e&&(t="function"==typeof e?e(n):u(u({},n),e)),t},i=function(e){var n=c(e.components);return s.a.createElement(d.Provider,{value:n},e.children)},m={inlineCode:"code",wrapper:function(e){var n=e.children;return s.a.createElement(s.a.Fragment,{},n)}},p=s.a.forwardRef((function(e,n){var t=e.components,o=e.mdxType,r=e.originalType,a=e.parentName,d=l(e,["components","mdxType","originalType","parentName"]),i=c(t),p=o,f=i["".concat(a,".").concat(p)]||i[p]||m[p]||r;return t?s.a.createElement(f,u(u({ref:n},d),{},{components:t})):s.a.createElement(f,u({ref:n},d))}));function f(e,n){var t=arguments,o=n&&n.mdxType;if("string"==typeof e||o){var r=t.length,a=new Array(r);a[0]=p;var u={};for(var l in n)hasOwnProperty.call(n,l)&&(u[l]=n[l]);u.originalType=e,u.mdxType="string"==typeof e?e:o,a[1]=u;for(var d=2;d<r;d++)a[d]=t[d];return s.a.createElement.apply(null,a)}return s.a.createElement.apply(null,t)}p.displayName="MDXCreateElement"}}]);